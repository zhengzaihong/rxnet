# RxNet 0.5.0 è¿ç§»æŒ‡å—

## ğŸ“‹ ç‰ˆæœ¬è¯´æ˜

- **æ–°ç‰ˆæœ¬ï¼š** 0.5.0
- **è¿ç§»éš¾åº¦ï¼š** ğŸŸ¡ ä½

---

## ğŸ¯ æ ¸å¿ƒå˜æ›´

### ä¸»è¦æ”¹è¿›

1. **å‚æ•°ç±»å‹æ˜ç¡®åŒ–** - è·¯å¾„å‚æ•°ã€æŸ¥è¯¢å‚æ•°ã€Bodyå‚æ•°åˆ†ç¦»
2. **RESTfulè‡ªåŠ¨æ£€æµ‹** - æ— éœ€æ‰‹åŠ¨è®¾ç½®
3. **APIè¯­ä¹‰åŒ–** - æ–¹æ³•åæ›´ç›´è§‚
4. **åº•å±‚é‡æ„** - æ›´æ–° `BuildRequest`

**æ–°å¢APIï¼š**
- `setPathParam(key, value)` - è®¾ç½®RESTfulè·¯å¾„å‚æ•°
- `setQueryParam(key, value)` - è®¾ç½®URLæŸ¥è¯¢å‚æ•°
- `setBodyParam(key, value)` - è®¾ç½®è¯·æ±‚ä½“å‚æ•°
- `setRawBody(body)` - è®¾ç½®åŸå§‹Bodyæ•°æ®

### âš ï¸ å…¼å®¹å˜æ›´

| æ—§API (0.4.3) | æ–°API (0.5.0) | è¯´æ˜ |
|--------------|--------------|------|
| `.setParam()` | `.setPathParam()`/`.setQueryParam()`/`.setBodyParam()` | å‚æ•°ç±»å‹æ˜ç¡® |
| `.setRestfulUrl(true)` | è‡ªåŠ¨æ£€æµ‹ | æ— éœ€æ‰‹åŠ¨è®¾ç½® |
| `.toBodyData()` | `.asJson()` | æ›´è¯­ä¹‰åŒ– |
| `.toFormData()` | `.asFormData()` | æ›´è¯­ä¹‰åŒ– |

---


## ğŸ‰ æ–°ç‰ˆAPIä½¿ç”¨æŒ‡å—

### 1. GETè¯·æ±‚ - RESTfulé£æ ¼

```dart
// è‡ªåŠ¨æ£€æµ‹RESTfulè·¯å¾„ï¼Œæ— éœ€æ‰‹åŠ¨è®¾ç½®
final result = await RxNet.get()
  .setPath("/api/weather/city/{id}")
  .setPathParam("id", "101030100")  // è·¯å¾„å‚æ•°ï¼šæ›¿æ¢{id}
  .setQueryParam("lang", "zh")      // æŸ¥è¯¢å‚æ•°ï¼š?lang=zh
  .setCacheMode(CacheMode.CACHE_EMPTY_OR_EXPIRED_THEN_REQUEST)
  .setJsonConvert(WeatherInfo.fromJson)
  .request<WeatherInfo>();

if (result.isSuccess) {
  print("å¤©æ°”æ•°æ®ï¼š${result.value}");
  print("æ•°æ®æ¥æºï¼š${result.model}");  // ç½‘ç»œæˆ–ç¼“å­˜
}
```

### 2. POSTè¯·æ±‚ - JSONæ ¼å¼

```dart
final result = await RxNet.post()
  .setPath("/api/user")
  .setBodyParams({
    "name": "å¼ ä¸‰",
    "age": 25,
    "email": "zhangsan@example.com"
  })
  .asJson()  // æ˜ç¡®æŒ‡å®šJSONæ ¼å¼
  .setJsonConvert(User.fromJson)
  .request<User>();
```

### 3. æ–‡ä»¶ä¸Šä¼  - FormDataæ ¼å¼

```dart
final file = await MultipartFile.fromFile(
  filePath,
  filename: "avatar.jpg"
);

final result = await RxNet.post()
  .setPath("/api/upload/avatar/{userId}")
  .setPathParam("userId", "123")
  .setBodyParam("file", file)
  .setBodyParam("description", "ç”¨æˆ·å¤´åƒ")
  .asFormData()  // æ˜ç¡®æŒ‡å®šFormDataæ ¼å¼
  .request();
```

### 4. å¤æ‚æŸ¥è¯¢ - æ··åˆå‚æ•°

```dart
final result = await RxNet.get()
  .setPath("/api/categories/{categoryId}/products")
  .setPathParam("categoryId", "electronics")  // è·¯å¾„å‚æ•°
  .setQueryParams({                           // æŸ¥è¯¢å‚æ•°
    "keyword": "æ‰‹æœº",
    "minPrice": 1000,
    "maxPrice": 5000,
    "page": 1,
    "size": 20
  })
  .setIgnoreCacheKey("page")  // å¿½ç•¥pageå‚æ•°ç”Ÿæˆç¼“å­˜é”®
  .setCacheMode(CacheMode.FIRST_USE_CACHE_THEN_REQUEST)
  .request();
// æœ€ç»ˆURL: /api/categories/electronics/products?keyword=æ‰‹æœº&minPrice=1000&...
```

### 5. å›è°ƒæ–¹å¼

```dart
RxNet.get()
  .setPath("/api/weather/city/{id}")
  .setPathParam("id", "101030100")
  .setCacheMode(CacheMode.CACHE_EMPTY_OR_EXPIRED_THEN_REQUEST)
  .setJsonConvert(WeatherInfo.fromJson)
  .execute<WeatherInfo>(
    success: (data, source) {
      setState(() {
        content = jsonEncode(data);
        sourcesType = source;
      });
    },
    failure: (e) {
      setState(() {
        content = "è¯·æ±‚å¤±è´¥: $e";
      });
    },
    completed: () {
      // è¯·æ±‚å®Œæˆåçš„å›è°ƒ
    }
  );
```

## ğŸ“Š æ–°æ—§APIå¯¹æ¯”

### å‚æ•°è®¾ç½®

| åœºæ™¯ | 0.4.3 | 0.5.0 |
|-----|-------|-------|
| RESTfulè·¯å¾„å‚æ•° | `.setParam("id", "123")` + `.setRestfulUrl(true)` | `.setPathParam("id", "123")` |
| URLæŸ¥è¯¢å‚æ•° | `.setParam("page", 1)` | `.setQueryParam("page", 1)` |
| POST Bodyå‚æ•° | `.setParams({...})` | `.setBodyParams({...})` |

### è¯·æ±‚ä½“ç±»å‹

| åœºæ™¯ | 0.4.3 | 0.5.0 |
|-----|-------|-------|
| JSONæ ¼å¼ | `.toBodyData()` | `.asJson()` |
| FormDataæ ¼å¼ | `.toFormData()` | `.asFormData()` |
| URLç¼–ç æ ¼å¼ | `.toUrlEncoded()` | `.asUrlEncoded()` |


---

## ğŸ”„ å‘åå…¼å®¹æ€§

æ‰€æœ‰æ—§APIéƒ½ä¿ç•™å¹¶æ ‡è®°ä¸º `@Deprecated`ï¼Œç¡®ä¿ç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹å³å¯è¿è¡Œï¼š

```dart
// âœ… æ—§ä»£ç ä»ç„¶å¯ä»¥æ­£å¸¸å·¥ä½œ
RxNet.get()
    .setPath("/user/{id}")
.setParam("id", "123")
    .setRestfulUrl(true)
    .toBodyData()
    .request();

## ğŸ”„ å¿«é€Ÿè¿ç§»å¯¹ç…§

### 1. GETè¯·æ±‚ï¼ˆRESTfulï¼‰

```dart
// âŒ 0.4.3 ç‰ˆæœ¬
RxNet.get()
  .setPath("/user/{id}")
  .setParam("id", "123")
  .setRestfulUrl(true)
  .request();

// âœ… 0.5.0 ç‰ˆæœ¬
RxNet.get()
  .setPath("/user/{id}")
  .setPathParam("id", "123")  // æ˜ç¡®ï¼šè·¯å¾„å‚æ•°
  .request();
```

### 2. GETè¯·æ±‚ï¼ˆå¸¦æŸ¥è¯¢å‚æ•°ï¼‰

```dart
// âŒ 0.4.3 ç‰ˆæœ¬
RxNet.get()
  .setPath("/users")
  .setParam("page", 1)
  .setParam("size", 20)
  .request();

// âœ… 0.5.0 ç‰ˆæœ¬
RxNet.get()
  .setPath("/users")
  .setQueryParam("page", 1)    // æ˜ç¡®ï¼šæŸ¥è¯¢å‚æ•°
  .setQueryParam("size", 20)
  .request();
```

### 3. POSTè¯·æ±‚ï¼ˆJSONï¼‰

```dart
// âŒ 0.4.3 ç‰ˆæœ¬
RxNet.post()
  .setPath("/api/user")
  .setParams({"name": "å¼ ä¸‰", "age": 25})
  .toBodyData()
  .request();

// âœ… 0.5.0 ç‰ˆæœ¬
RxNet.post()
  .setPath("/api/user")
  .setBodyParams({"name": "å¼ ä¸‰", "age": 25})
  .asJson()  // æ˜ç¡®ï¼šJSONæ ¼å¼
  .request();
```

### 4. æ–‡ä»¶ä¸Šä¼ 

```dart
// âŒ 0.4.3 ç‰ˆæœ¬
RxNet.post()
  .setPath("/upload")
  .setParam("file", file)
  .toFormData()
  .request();

// âœ… 0.5.0 ç‰ˆæœ¬
RxNet.post()
  .setPath("/upload")
  .setBodyParam("file", file)
  .asFormData()  // æ˜ç¡®ï¼šFormDataæ ¼å¼
  .request();
```

### 5. æ··åˆå‚æ•°ï¼ˆè·¯å¾„+Bodyï¼‰

```dart
// âŒ 0.4.3 ç‰ˆæœ¬
RxNet.post()
  .setPath("/users/{userId}/profile")
  .setParam("userId", "123")
  .setParam("name", "å¼ ä¸‰")
  .setRestfulUrl(true)
  .toBodyData()
  .request();

// âœ… 0.5.0 ç‰ˆæœ¬
RxNet.post()
  .setPath("/users/{userId}/profile")
  .setPathParam("userId", "123")  // è·¯å¾„å‚æ•°
  .setBodyParams({"name": "å¼ ä¸‰"}) // Bodyå‚æ•°
  .asJson()
  .request();
```

---



---

## ğŸš€ é«˜çº§ç‰¹æ€§

### 1. è‡ªå®šä¹‰Bodyæ•°æ®

```dart
// å‘é€è‡ªå®šä¹‰æ ¼å¼çš„Body
RxNet.post()
  .setPath("/api/custom")
  .setRawBody(customData)  // ç›´æ¥è®¾ç½®åŸå§‹Body
  .setContentType("application/custom")
  .request();
```

### 2. åŠ¨æ€Bodyç±»å‹

```dart
// æ ¹æ®æ¡ä»¶åŠ¨æ€é€‰æ‹©Bodyç±»å‹
final bodyType = hasFile ? RequestBodyType.formData : RequestBodyType.json;

RxNet.post()
  .setPath("/api/submit")
  .setBodyParams(params)
  .setBodyType(bodyType)
  .request();
```

### 3. å‚æ•°é¢„å¤„ç†

```dart
// ç§»é™¤nullå€¼
RxNet.post()
  .setPath("/api/user")
  .setBodyParams({"name": "å¼ ä¸‰", "age": null, "email": "test@example.com"})
  .removeNullValueKeys()  // ç§»é™¤ageå­—æ®µ
  .asJson()
  .request();
```

---

## ğŸ“Š å®Œæ•´APIå¯¹ç…§è¡¨

### å‚æ•°è®¾ç½®æ–¹æ³•

| 0.4.3 | 0.5.0 | ç”¨é€” |
|-------|-------|------|
| `setParam(key, value)` | `setPathParam(key, value)` | RESTfulè·¯å¾„å‚æ•° |
| `setParam(key, value)` | `setQueryParam(key, value)` | URLæŸ¥è¯¢å‚æ•° |
| `setParam(key, value)` | `setBodyParam(key, value)` | è¯·æ±‚ä½“å‚æ•° |
| `setParams(map)` | `setPathParams(map)` | æ‰¹é‡è·¯å¾„å‚æ•° |
| `setParams(map)` | `setQueryParams(map)` | æ‰¹é‡æŸ¥è¯¢å‚æ•° |
| `setParams(map)` | `setBodyParams(map)` | æ‰¹é‡Bodyå‚æ•° |

### è¯·æ±‚ä½“ç±»å‹æ–¹æ³•

| 0.4.3 | 0.5.0 | è¯´æ˜ |
|-------|-------|------|
| `toBodyData()` | `asJson()` | JSONæ ¼å¼ |
| `toFormData()` | `asFormData()` | FormDataæ ¼å¼ |
| `toUrlEncoded()` | `asUrlEncoded()` | URLç¼–ç æ ¼å¼ |

### RESTfulé…ç½®

| 0.4.3 | 0.5.0 | è¯´æ˜ |
|-------|-------|------|
| `setRestfulUrl(true)` | è‡ªåŠ¨æ£€æµ‹ | æ— éœ€æ‰‹åŠ¨è®¾ç½® |
| `isRestfulUrl()` | æ¡†æ¶è‡ªåŠ¨å¤„ç† | æ— éœ€è°ƒç”¨ |

---

## âœ… è¿ç§»æ­¥éª¤

### æ­¥éª¤1ï¼šæ›´æ–°ä¾èµ–

```yaml
# pubspec.yaml
dependencies:
  rxnet_plus: ^0.5.0  # ä» 0.4.3 å‡çº§åˆ° 0.5.0
```

### æ­¥éª¤2ï¼šæ‰¹é‡æ›¿æ¢

ä½¿ç”¨IDEçš„æŸ¥æ‰¾æ›¿æ¢åŠŸèƒ½ï¼š

1. **æ›¿æ¢ toBodyData**
   - æŸ¥æ‰¾ï¼š`.toBodyData()`
   - æ›¿æ¢ï¼š`.asJson()`

2. **æ›¿æ¢ toFormData**
   - æŸ¥æ‰¾ï¼š`.toFormData()`
   - æ›¿æ¢ï¼š`.asFormData()`

3. **åˆ é™¤ setRestfulUrl**
   - æŸ¥æ‰¾ï¼š`.setRestfulUrl(true)`
   - æ›¿æ¢ï¼šï¼ˆç©ºï¼‰

### æ­¥éª¤3ï¼šæ‰‹åŠ¨è°ƒæ•´å‚æ•°

æ ¹æ®å®é™…æƒ…å†µï¼Œå°† `setParam()` æ”¹ä¸ºï¼š
- `setPathParam()` - å¦‚æœæ˜¯RESTfulè·¯å¾„å‚æ•°
- `setQueryParam()` - å¦‚æœæ˜¯URLæŸ¥è¯¢å‚æ•°
- `setBodyParam()` - å¦‚æœæ˜¯POST/PUT/PATCHçš„Bodyå‚æ•°

---

## ğŸ¯ ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šç”¨æˆ·ç®¡ç†API

```dart
class UserApi {
  // è·å–ç”¨æˆ·åˆ—è¡¨
  static Future<UserListResponse> getUserList({
    int page = 1,
    int size = 20,
    String? status,
  }) async {
    final result = await RxNet.get()
      .setPath("/api/users")
      .setQueryParams({
        "page": page,
        "size": size,
        if (status != null) "status": status,
      })
      .setCacheMode(CacheMode.CACHE_EMPTY_OR_EXPIRED_THEN_REQUEST)
      .setJsonConvert(UserListResponse.fromJson)
      .request<UserListResponse>();
    
    return result.value!;
  }

  // è·å–ç”¨æˆ·è¯¦æƒ…
  static Future<User> getUserDetail(String userId) async {
    final result = await RxNet.get()
      .setPath("/api/users/{id}")
      .setPathParam("id", userId)
      .setJsonConvert(User.fromJson)
      .request<User>();
    
    return result.value!;
  }

  // åˆ›å»ºç”¨æˆ·
  static Future<User> createUser({
    required String name,
    required String email,
    String? phone,
  }) async {
    final result = await RxNet.post()
      .setPath("/api/users")
      .setBodyParams({
        "name": name,
        "email": email,
        if (phone != null) "phone": phone,
      })
      .asJson()
      .setJsonConvert(User.fromJson)
      .request<User>();
    
    return result.value!;
  }

  // æ›´æ–°ç”¨æˆ·
  static Future<User> updateUser(
    String userId,
    Map<String, dynamic> updates,
  ) async {
    final result = await RxNet.put()
      .setPath("/api/users/{id}")
      .setPathParam("id", userId)
      .setBodyParams(updates)
      .asJson()
      .setJsonConvert(User.fromJson)
      .request<User>();
    
    return result.value!;
  }

  // åˆ é™¤ç”¨æˆ·
  static Future<void> deleteUser(String userId) async {
    await RxNet.delete()
      .setPath("/api/users/{id}")
      .setPathParam("id", userId)
      .request();
  }
}
```

### ç¤ºä¾‹2ï¼šå•†å“æœç´¢API

```dart
class ProductApi {
  // æœç´¢å•†å“
  static Future<ProductListResponse> searchProducts({
    required String categoryId,
    String? keyword,
    double? minPrice,
    double? maxPrice,
    String? brand,
    String? sort,
    int page = 1,
    int size = 20,
  }) async {
    final queryParams = <String, dynamic>{
      "page": page,
      "size": size,
    };
    
    if (keyword != null) queryParams["keyword"] = keyword;
    if (minPrice != null) queryParams["minPrice"] = minPrice;
    if (maxPrice != null) queryParams["maxPrice"] = maxPrice;
    if (brand != null) queryParams["brand"] = brand;
    if (sort != null) queryParams["sort"] = sort;
    
    final result = await RxNet.get()
      .setPath("/api/categories/{categoryId}/products")
      .setPathParam("categoryId", categoryId)
      .setQueryParams(queryParams)
      .setIgnoreCacheKey("page")  // å¿½ç•¥pageå‚æ•°ç”Ÿæˆç¼“å­˜é”®
      .setCacheMode(CacheMode.FIRST_USE_CACHE_THEN_REQUEST)
      .setJsonConvert(ProductListResponse.fromJson)
      .request<ProductListResponse>();
    
    return result.value!;
  }
}
```

### ç¤ºä¾‹3ï¼šæ–‡ä»¶ä¸Šä¼ API

```dart
class FileApi {
  // ä¸Šä¼ å¤´åƒ
  static Future<String> uploadAvatar(
    String userId,
    String filePath,
  ) async {
    final file = await MultipartFile.fromFile(
      filePath,
      filename: "avatar.jpg",
    );
    
    final result = await RxNet.post()
      .setPath("/api/upload/avatar/{userId}")
      .setPathParam("userId", userId)
      .setBodyParam("file", file)
      .setBodyParam("description", "ç”¨æˆ·å¤´åƒ")
      .asFormData()
      .setJsonConvert((data) => data['url'] as String)
      .request<String>();
    
    return result.value!;
  }

  // æ‰¹é‡ä¸Šä¼ æ–‡ä»¶
  static Future<List<String>> uploadMultipleFiles(
    List<String> filePaths,
  ) async {
    final files = await Future.wait(
      filePaths.map((path) => MultipartFile.fromFile(path)),
    );
    
    final result = await RxNet.post()
      .setPath("/api/upload/batch")
      .setBodyParam("files", files)
      .setBodyParam("category", "documents")
      .asFormData()
      .setJsonConvert((data) => (data['urls'] as List).cast<String>())
      .request<List<String>>();
    
    return result.value!;
  }
}
```

---

## ğŸ“ è¿ç§»æ£€æŸ¥æ¸…å•

### ä»£ç ä¿®æ”¹
- [ ] æ›´æ–° pubspec.yaml ä¾èµ–ç‰ˆæœ¬
- [ ] æ›¿æ¢æ‰€æœ‰ `toBodyData()` ä¸º `asJson()`
- [ ] æ›¿æ¢æ‰€æœ‰ `toFormData()` ä¸º `asFormData()`
- [ ] æ›¿æ¢æ‰€æœ‰ `toUrlEncoded()` ä¸º `asUrlEncoded()`
- [ ] åˆ é™¤æ‰€æœ‰ `setRestfulUrl(true)` è°ƒç”¨
- [ ] å°† `setParam()` æ”¹ä¸ºå¯¹åº”çš„å…·ä½“æ–¹æ³•
- [ ] å°† `setParams()` æ”¹ä¸ºå¯¹åº”çš„æ‰¹é‡æ–¹æ³•
- [ ] æ£€æŸ¥æ–‡ä»¶ä¸Šä¼ ä»£ç 
- [ ] æ£€æŸ¥æ–‡ä»¶ä¸‹è½½ä»£ç 


---

## â“ å¸¸è§é—®é¢˜

### Q1: å¿…é¡»ç«‹å³å‡çº§å—ï¼Ÿ
ä¸æ˜¯å¿…é¡»çš„ã€‚ä½†å»ºè®®æ–°é¡¹ç›®ä½¿ç”¨0.5.0ä»¥ä¸Šã€‚

### Q2: è¿ç§»éœ€è¦å¤šä¹…ï¼Ÿ
- å°é¡¹ç›®ï¼ˆ<50ä¸ªè¯·æ±‚ï¼‰ï¼š1-2å°æ—¶
- ä¸­é¡¹ç›®ï¼ˆ50-200ä¸ªè¯·æ±‚ï¼‰ï¼šåŠå¤©
- å¤§é¡¹ç›®ï¼ˆ>200ä¸ªè¯·æ±‚ï¼‰ï¼š1-2å¤©

### Q3: æ€§èƒ½ä¼šæå‡å—ï¼Ÿ
æ€§èƒ½åŸºæœ¬æŒå¹³ï¼Œä¸»è¦æå‡åœ¨ä»£ç å¯è¯»æ€§å’Œç»´æŠ¤æ€§ã€‚

### Q4: ç¼“å­˜åŠŸèƒ½æœ‰å˜åŒ–å—ï¼Ÿ
ç¼“å­˜åŠŸèƒ½ä¿æŒä¸å˜ï¼Œä½†ç¼“å­˜é”®ç”Ÿæˆæ›´å¯é ã€‚

### Q5: ä¸‹è½½ä¸Šä¼ æœ‰å˜åŒ–å—ï¼Ÿ
å›è°ƒæ–¹å¼ä¸å˜ï¼Œä½†å‚æ•°è®¾ç½®éœ€è¦æ›´æ–°ã€‚

---

## ğŸš€ è¿ç§»æ”¶ç›Š

### ä»£ç è´¨é‡
- âœ… å¯è¯»æ€§æå‡
- âœ… å‡ºé”™ç‡é™ä½ 

### å›¢é˜Ÿåä½œ
- âœ… ä»£ç æ›´æ˜“ç†è§£
- âœ… æ–°äººä¸Šæ‰‹æ›´å¿«
- âœ… Code Reviewæ›´é«˜æ•ˆ

---
